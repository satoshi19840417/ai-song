# マッピングルール

## 優先順位

1. **URL song id 一致** (最優先)
   - `suno_song_url` から `https://suno.com/song/<id>` の `<id>` を抽出
   - fetch された clip の `id` と比較
   - 完全一致で確定

2. **タイトル完全一致**
   - 前後空白を除いた文字列比較

3. **タイトル正規化一致**
   - 全角→半角変換 (`unicodedata.normalize("NFKC", ...)`)
   - 小文字化
   - スペース・記号・括弧類を除去
   - 上記変換後に一致すれば確定

## 曖昧ケースの扱い

| ケース | 処理 |
|--------|------|
| 同名タイトル（正規化後）が複数存在 | 自動確定しない → 未確定として同期メモへ |
| 非公開クリップ (`status: private`) | 同期メモへ「非公開クリップ」として記録 |
| fetch失敗（APIエラー） | スクリプトエラー終了 + 同期メモへ理由記録 |

## 新規曲の扱い

- マッチなし → 新規曲として追加
- ID採番: `SNG-<実行年>-<4桁連番>`（既存最大+1）
- ファイル名: `SNG-YYYY-NNNN_<タイトル>.md`（OS非互換文字を `_` に置換）

## 更新対象フィールド（既存曲）

- `suno_song_url`: 未設定の場合のみ追記
- `tags`: 空の場合のみ補完（既存値を上書きしない）

歌詞・スタイル・制作メモ・変更履歴は変更しない。
